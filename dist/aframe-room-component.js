/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else {
		var a = factory();
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(self, () => {
return /******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./index.js":
/*!******************!*\
  !*** ./index.js ***!
  \******************/
/***/ (() => {

eval("AFRAME.registerSystem('building',{\r\n\t\r\n\treexamineBuilding:function(){\r\n\t\t\r\n\t\t//console.log(\" = REEVALUATION REQUESTED...\");\r\n\t\t\r\n\t\tvar buildingSelf = this;\r\n\t\tvar HAIR = 0.0001;\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t/*\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\thttps://github.com/omgitsraven/aframe-room-component\r\n\t\tv0.4.2\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tOPTIMIZATION:\r\n\t\t\r\n\t\tcurrently, the entire building is getting re-generated from scratch any time anything in it changes.\r\n\t\tobviously this is wasteful, but:\r\n\t\t- this library isn't particularly likely to be used in a context where these properties will be changing at runtime (at least outside of debugging)\r\n\t\t- right now I am more concerned with getting it out the door than making it perfect anyway\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tPLANNED FEATURES TO COME (in order):\r\n\t\t- greater control over UV generation\r\n\t\t- automatic collision assignment\r\n\t\t- doors lifted above the ground (i.e. windows)\r\n\t\t- accept a shape to be extruded around a doorhole to make a doorframe (& around a floor to make a baseboard)\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tKNOWN ISSUES (with no obvious solution that would preserve ease of use):\r\n\t\t- floor/ceiling triangulation is not controllable (and therefore varying wall verticality is nearly useless unless slope is consistent)\r\n\t\t- doorhole parenting is always level to the horizon even on slope-floored walls\r\n\t\t- the setTimeout thing results in a one-frame flash of invisible walls: is it worth it? (is there a smarter thing to listen for, maybe?)\r\n\t\t\r\n\t\tISSUES THAT COULD THEORETICALLY BE FIXED BUT DON'T SEEM WORTH THE TROUBLE:\r\n\t\t- walls are internally rearranged to always wind CW, which means wall parenting will point towards the \"previous\" wall if you entered them in CCW order\r\n\t\t\r\n\t\t*/\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tfunction flipGeom(geom){\r\n\t\t\tconst indices = geom.getIndex().array;\r\n\t\t\tfor (let i = 0; i < indices.length; i += 3) {\r\n\t\t\t\tconst tempIndex = indices[i + 2];\r\n\t\t\t\tindices[i + 2] = indices[i + 1];\r\n\t\t\t\tindices[i + 1] = tempIndex;\r\n\t\t\t}\r\n\r\n\t\t\tgeom.getIndex().needsUpdate = true;\r\n\t\t}\r\n\t\t\r\n\t\tfunction makeUvsForGeom(geom,callback){\r\n\t\t\tvar allUVs = [];\r\n\t\t\tfor(var faceVertIndex=0; faceVertIndex<geom.index.array.length; faceVertIndex++){\r\n\t\t\t\tvar vertexIndex = geom.index.array[faceVertIndex];\r\n\t\t\t\tvar vertex = new THREE.Vector3(\r\n\t\t\t\t\tgeom.attributes.position.getX(vertexIndex),\r\n\t\t\t\t\tgeom.attributes.position.getY(vertexIndex),\r\n\t\t\t\t\tgeom.attributes.position.getZ(vertexIndex)\r\n\t\t\t\t);\r\n\t\t\t\tvar uv = callback(vertex,faceVertIndex%3);\r\n\t\t\t\tallUVs[vertexIndex*2+0] = uv[0];\r\n\t\t\t\tallUVs[vertexIndex*2+1] = uv[1];\r\n\t\t\t}\r\n\t\t\tgeom.setAttribute('uv',new THREE.BufferAttribute(new Float32Array(allUVs),2));\r\n\t\t\tgeom.uvsNeedUpdate = true;\r\n\t\t\t\r\n\t\t}\r\n\t\tfunction makePlaneUvs(geom,uKey,vKey,uMult,vMult){\r\n\t\t\tmakeUvsForGeom(geom,function(pt){\r\n\t\t\t\treturn [\r\n\t\t\t\t\tpt[uKey]*uMult,\r\n\t\t\t\t\tpt[vKey]*vMult\r\n\t\t\t\t];\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tfunction finishGeom(geom){\r\n\t\t\tgeom.computeVertexNormals();\r\n\t\t\t// are these necessary?\r\n\t\t\tgeom.computeBoundingBox();\r\n\t\t\tgeom.computeBoundingSphere();\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tfunction getUnsortedRoomWallArray(roomEl){\r\n\t\t\tvar walls=[];\r\n\t\t\tfor(var roomChildNodeIndex=0; roomChildNodeIndex<roomEl.children.length; roomChildNodeIndex++){\r\n\t\t\t\tvar roomChildNode = roomEl.children[roomChildNodeIndex];\r\n\t\t\t\tif (roomChildNode.components.wall) walls.push(roomChildNode);\r\n\t\t\t}\r\n\t\t\treturn walls;\r\n\t\t}\r\n\t\t\r\n\t\tfunction getRoomWallArray(roomEl){\r\n\t\t\t\r\n\t\t\t// the results of this not being saved anywhere is super wasteful,\r\n\t\t\t// but, see above; not worth worrying about yet\r\n\t\t\t\r\n\t\t\tvar isOutside = roomEl.components.room.data.outside;\r\n\t\t\t\r\n\t\t\tvar walls = getUnsortedRoomWallArray(roomEl);\r\n\t\t\t\r\n\t\t\tvar cwSum=0;\r\n\t\t\tfor(var wallIndex=0; wallIndex<walls.length; wallIndex++){\r\n\t\t\t\tvar curWallNode = walls[wallIndex];\r\n\t\t\t\tvar nextWallNode = walls[(wallIndex+1)%walls.length];\r\n\t\t\t\tvar curWallPos = curWallNode.components.position.data;\r\n\t\t\t\tvar nextWallPos = nextWallNode.components.position.data;\r\n\t\t\t\t\r\n\t\t\t\tcwSum += (nextWallPos.x - curWallPos.x) * (nextWallPos.z + curWallPos.z);\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar shouldReverse = false;\r\n\t\t\tif (cwSum > 0) shouldReverse = !shouldReverse;\r\n\t\t\tif (isOutside) shouldReverse = !shouldReverse;\r\n\t\t\tif (shouldReverse) walls.reverse();\r\n\t\t\t\r\n\t\t\treturn walls;\r\n\t\t\t\r\n\t\t}\r\n\t\tfunction getNextWallEl(wallEl){\r\n\t\t\tvar wallList = getRoomWallArray(wallEl.parentNode);\r\n\t\t\tvar curWallIndex = wallList.indexOf(wallEl);\r\n\t\t\treturn wallList[(curWallIndex+1)%wallList.length];\r\n\t\t}\r\n\t\t\r\n\t\tvar worldWallPos = new THREE.Vector3();\r\n\t\tvar worldNextPos = new THREE.Vector3();\r\n\t\tvar worldLinkPos = new THREE.Vector3();\r\n\t\tfunction moveForLink(doorholeEl,doorlinkEl){\r\n\t\t\t\r\n\t\t\tvar holeWallEl = doorholeEl.parentNode;\r\n\t\t\tvar nextWallEl = getNextWallEl(holeWallEl);\r\n\t\t\tif (!nextWallEl) return;\r\n\t\t\t\r\n\t\t\tholeWallEl.object3D.getWorldPosition(worldWallPos);\r\n\t\t\tnextWallEl.object3D.getWorldPosition(worldNextPos);\r\n\t\t\tdoorlinkEl.object3D.getWorldPosition(worldLinkPos);\r\n\t\t\t\r\n\t\t\tvar linkGapX = worldLinkPos.x - worldWallPos.x;\r\n\t\t\tvar linkGapZ = worldLinkPos.z - worldWallPos.z;\r\n\t\t\t\r\n\t\t\tvar wallGapX = worldNextPos.x - worldWallPos.x;\r\n\t\t\tvar wallGapZ = worldNextPos.z - worldWallPos.z;\r\n\t\t\tvar wallAng = Math.atan2(wallGapZ,wallGapX);\r\n\t\t\tvar wallLength = Math.sqrt(wallGapX*wallGapX + wallGapZ*wallGapZ);\r\n\t\t\t\r\n\t\t\tvar localLinkX = linkGapX*Math.cos(-wallAng) - linkGapZ*Math.sin(-wallAng);\r\n\t\t\t//var localLinkZ = linkGapX*Math.sin(-wallAng) + linkGapZ*Math.cos(-wallAng);\r\n\t\t\t\r\n\t\t\tvar doorHalf = doorlinkEl.components.doorlink.data.width / 2;\r\n\t\t\tlocalLinkX = Math.max(localLinkX,doorHalf+HAIR);\r\n\t\t\tlocalLinkX = Math.min(localLinkX,wallLength-doorHalf-HAIR);\r\n\t\t\t\r\n\t\t\tdoorholeEl.setAttribute(\"position\",{x:localLinkX,y:0,z:0});\r\n\t\t\tdoorholeEl.object3D.updateMatrixWorld();\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tfunction getHoleLink(doorholeEl){\r\n\t\t\tvar doorlinks = buildingSelf.el.querySelectorAll('[doorlink]');\r\n\t\t\tfor(var curLinkIndex=0; curLinkIndex<doorlinks.length; curLinkIndex++){\r\n\t\t\t\tvar curLink = doorlinks[curLinkIndex];\r\n\t\t\t\tif (curLink.components.doorlink.data.from == doorholeEl) return curLink;\r\n\t\t\t\tif (curLink.components.doorlink.data.to   == doorholeEl) return curLink;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction getWallHeight(wallEl){\r\n\t\t\tif (wallEl.components.wall.data.height) return wallEl.components.wall.data.height;\r\n\t\t\treturn wallEl.parentNode.components.room.data.height;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\tif (buildingSelf.dirty) return;\r\n\t\tbuildingSelf.dirty = true;\r\n\t\tsetTimeout(function(){\r\n\t\t\t\r\n\t\t\t//console.log(\" == STARTING RE-EVALUATION...\");\r\n\t\t\t\r\n\t\t\t// silly but necessary because of threeJS weirdness\r\n\t\t\tbuildingSelf.el.object3D.updateMatrixWorld();\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// lay out walls' angles:\r\n\t\t\t\r\n\t\t\tfor(var sceneChildNodeIndex=0; sceneChildNodeIndex<buildingSelf.el.children.length; sceneChildNodeIndex++){\r\n\t\t\t\tvar sceneChildNode = buildingSelf.el.children[sceneChildNodeIndex];\r\n\t\t\t\tif (sceneChildNode.components && sceneChildNode.components.room) {\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar w = sceneChildNode.components.room.data.width;\r\n\t\t\t\t\tvar l = sceneChildNode.components.room.data.length;\r\n\t\t\t\t\tif (w || l) {\r\n\t\t\t\t\t\tif (w && l) {\r\n\t\t\t\t\t\t\tvar rawWalls = getUnsortedRoomWallArray(sceneChildNode);\r\n\t\t\t\t\t\t\tif (rawWalls.length >= 4) {\r\n\t\t\t\t\t\t\t\tif (rawWalls.length > 4) console.error(\"rooms with WIDTH and LENGTH should only have four walls!\");\r\n\t\t\t\t\t\t\t\trawWalls[0].setAttribute(\"position\",{x:0,y:0,z:0});\r\n\t\t\t\t\t\t\t\trawWalls[1].setAttribute(\"position\",{x:w,y:0,z:0});\r\n\t\t\t\t\t\t\t\trawWalls[2].setAttribute(\"position\",{x:w,y:0,z:l});\r\n\t\t\t\t\t\t\t\trawWalls[3].setAttribute(\"position\",{x:0,y:0,z:l});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconsole.error(\"rooms with WIDTH and LENGTH must have four walls!\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.error(\"rooms with WIDTH must also have LENGTH (and vice versa)\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar walls=getRoomWallArray(sceneChildNode);\r\n\t\t\t\t\tif (walls.length > 2) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor(var wallIndex=0; wallIndex<walls.length; wallIndex++){\r\n\t\t\t\t\t\t\tvar curWallNode = walls[wallIndex];\r\n\t\t\t\t\t\t\tvar nextWallNode = walls[(wallIndex+1)%walls.length];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar wallGapX = nextWallNode.components.position.data.x - curWallNode.components.position.data.x;\r\n\t\t\t\t\t\t\tvar wallGapZ = nextWallNode.components.position.data.z - curWallNode.components.position.data.z;\r\n\t\t\t\t\t\t\tvar wallAng = Math.atan2(wallGapZ,wallGapX);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tcurWallNode.setAttribute(\"rotation\",{x:0,y:-wallAng/Math.PI*180,z:0});\r\n\t\t\t\t\t\t\tcurWallNode.object3D.updateMatrixWorld();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// position the door holes:\r\n\t\t\t\r\n\t\t\tvar doorlinks = buildingSelf.el.querySelectorAll('[doorlink]');\r\n\t\t\tfor(var curDoorlinkElIndex=0; curDoorlinkElIndex<doorlinks.length; curDoorlinkElIndex++){\r\n\t\t\t\tvar curDoorlinkEl = doorlinks[curDoorlinkElIndex];\r\n\t\t\t\tvar curDoorlink = curDoorlinkEl.components.doorlink;\r\n\t\t\t\tif (!curDoorlink) return;//still setting up, try again later\r\n\t\t\t\t\r\n\t\t\t\tmoveForLink(curDoorlink.data.from,curDoorlink.el);\r\n\t\t\t\tmoveForLink(curDoorlink.data.to,curDoorlink.el);\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// generate the walls' geometry:\r\n\t\t\t\r\n\t\t\tfor(var sceneChildNodeIndex=0; sceneChildNodeIndex<buildingSelf.el.children.length; sceneChildNodeIndex++){\r\n\t\t\t\tvar sceneChildNode = buildingSelf.el.children[sceneChildNodeIndex];\r\n\t\t\t\tif (sceneChildNode.components && sceneChildNode.components.room) {\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar isOutside = sceneChildNode.components.room.data.outside;\r\n\t\t\t\t\tvar walls=getRoomWallArray(sceneChildNode);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (walls.length > 2) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor(var wallIndex=0; wallIndex<walls.length; wallIndex++){\r\n\t\t\t\t\t\t\tvar curWallNode = walls[wallIndex];\r\n\t\t\t\t\t\t\tvar nextWallNode = walls[(wallIndex+1)%walls.length];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar wallGapX = nextWallNode.components.position.data.x - curWallNode.components.position.data.x;\r\n\t\t\t\t\t\t\tvar wallGapZ = nextWallNode.components.position.data.z - curWallNode.components.position.data.z;\r\n\t\t\t\t\t\t\tvar wallLength = Math.sqrt(wallGapX*wallGapX + wallGapZ*wallGapZ);\r\n\t\t\t\t\t\t\tvar wallAng = Math.atan2(wallGapZ,wallGapX);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar wallGapY = nextWallNode.components.position.data.y - curWallNode.components.position.data.y;\r\n\t\t\t\t\t\t\tvar heightGap = getWallHeight(nextWallNode) - getWallHeight(curWallNode);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar orderedHoles=[];\r\n\t\t\t\t\t\t\tfor(var wallChildNodeIndex=0; wallChildNodeIndex<curWallNode.children.length; wallChildNodeIndex++){\r\n\t\t\t\t\t\t\t\tvar wallChildNode = curWallNode.children[wallChildNodeIndex];\r\n\t\t\t\t\t\t\t\tif (wallChildNode.components && wallChildNode.components.doorhole) {\r\n\t\t\t\t\t\t\t\t\torderedHoles.push(wallChildNode);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\torderedHoles.sort(function(a,b){\r\n\t\t\t\t\t\t\t\treturn a.components.position.data.x - b.components.position.data.x;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar wallShape = new THREE.Shape();\r\n\t\t\t\t\t\t\twallShape.moveTo(\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\tgetWallHeight(curWallNode)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\twallShape.lineTo(\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t0\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tfor(var holeIndex=0; holeIndex<orderedHoles.length; holeIndex++){\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar holeEl = orderedHoles[holeIndex];\r\n\t\t\t\t\t\t\t\tif (!holeEl.myVerts) holeEl.myVerts = [];\r\n\t\t\t\t\t\t\t\tholeEl.myVerts.length=0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar linkEl = getHoleLink(orderedHoles[holeIndex]);\r\n\t\t\t\t\t\t\t\tif (!linkEl) continue;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar holeInfo = holeEl.components;\r\n\t\t\t\t\t\t\t\tvar linkInfo = linkEl.components;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor(var holeSide=-1; holeSide<=1; holeSide+=2){\r\n\t\t\t\t\t\t\t\t\tvar ptX = holeInfo.position.data.x + linkInfo.doorlink.data.width/2*holeSide;\r\n\t\t\t\t\t\t\t\t\tvar floorY = (ptX/wallLength)*wallGapY;\r\n\t\t\t\t\t\t\t\t\tvar topY = floorY + linkInfo.doorlink.data.height;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tvar curCeil = getWallHeight(curWallNode) + (ptX/wallLength)*heightGap;\r\n\t\t\t\t\t\t\t\t\tvar maxTopY = floorY + curCeil - HAIR;//will always be a seam, but, I'm not bothering to rewrite just for that\r\n\t\t\t\t\t\t\t\t\tif (topY > maxTopY) topY = maxTopY;\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tfunction addWorldVert(ptY){\r\n\t\t\t\t\t\t\t\t\t\tvar tempPos = new THREE.Vector3(ptX,ptY,0);\r\n\t\t\t\t\t\t\t\t\t\tcurWallNode.object3D.localToWorld(tempPos);\r\n\t\t\t\t\t\t\t\t\t\tholeEl.myVerts.push(tempPos);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\taddWorldVert(floorY);\r\n\t\t\t\t\t\t\t\t\taddWorldVert(topY);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (holeSide < 0) {\r\n\t\t\t\t\t\t\t\t\t\twallShape.lineTo(ptX,floorY);\r\n\t\t\t\t\t\t\t\t\t\twallShape.lineTo(ptX,topY);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\twallShape.lineTo(ptX,topY);\r\n\t\t\t\t\t\t\t\t\t\twallShape.lineTo(ptX,floorY);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\twallShape.lineTo(\r\n\t\t\t\t\t\t\t\twallLength,\r\n\t\t\t\t\t\t\t\tnextWallNode.components.position.data.y-curWallNode.components.position.data.y\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\twallShape.lineTo(\r\n\t\t\t\t\t\t\t\twallLength,\r\n\t\t\t\t\t\t\t\t(nextWallNode.components.position.data.y-curWallNode.components.position.data.y)+getWallHeight(nextWallNode)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar wallGeom = new THREE.ShapeGeometry(wallShape);\r\n\t\t\t\t\t\t\tmakePlaneUvs(wallGeom,'x','y',1,1);\r\n\t\t\t\t\t\t\tfinishGeom(wallGeom);\r\n\t\t\t\t\t\t\tvar myMat = curWallNode.components.material ? curWallNode.components.material.material : curWallNode.parentNode.components.material.material;\r\n\t\t\t\t\t\t\tif (curWallNode.myMesh) {\r\n\t\t\t\t\t\t\t\tcurWallNode.myMesh.geometry = wallGeom;\r\n\t\t\t\t\t\t\t\tcurWallNode.myMesh.material = myMat;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcurWallNode.myMesh = new THREE.Mesh(wallGeom, myMat);\r\n\t\t\t\t\t\t\t\tcurWallNode.setObject3D('wallMesh',curWallNode.myMesh);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar caps=[];\r\n\t\t\t\t\t\tfor(var roomChildNodeIndex=0; roomChildNodeIndex<sceneChildNode.children.length; roomChildNodeIndex++){\r\n\t\t\t\t\t\t\tvar roomChildNode = sceneChildNode.children[roomChildNodeIndex];\r\n\t\t\t\t\t\t\tif (roomChildNode.components) {\r\n\t\t\t\t\t\t\t\tif (roomChildNode.components.floor || roomChildNode.components.ceiling) caps.push(roomChildNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor(var curCapNodeIndex=0; curCapNodeIndex<caps.length; curCapNodeIndex++){\r\n\t\t\t\t\t\t\tvar curCapNode = caps[curCapNodeIndex];\r\n\t\t\t\t\t\t\tvar isCeiling = curCapNode.components.ceiling;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar capShape = new THREE.Shape();\r\n\t\t\t\t\t\t\tfor(var wallIndex=0; wallIndex<walls.length; wallIndex++){\r\n\t\t\t\t\t\t\t\tvar curWallNode = walls[wallIndex];\r\n\t\t\t\t\t\t\t\tvar ptX = curWallNode.components.position.data.x;\r\n\t\t\t\t\t\t\t\tvar ptZ = curWallNode.components.position.data.z;\r\n\t\t\t\t\t\t\t\tif (wallIndex) {\r\n\t\t\t\t\t\t\t\t\tcapShape.lineTo(ptX,ptZ);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcapShape.moveTo(ptX,ptZ);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar capGeom = new THREE.ShapeGeometry(capShape);\r\n\t\t\t\t\t\t\tfor(var wallIndex=0; wallIndex<walls.length; wallIndex++){\r\n\t\t\t\t\t\t\t\tvar curWallNode = walls[wallIndex];\r\n\t\t\t\t\t\t\t\tvar curVert = new THREE.Vector3(\r\n\t\t\t\t\t\t\t\t\tcapGeom.attributes.position.getX(wallIndex),\r\n\t\t\t\t\t\t\t\t\tcapGeom.attributes.position.getY(wallIndex),\r\n\t\t\t\t\t\t\t\t\tcapGeom.attributes.position.getZ(wallIndex)\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tcurVert.set(curVert.x,curWallNode.components.position.data.y,curVert.y);\r\n\t\t\t\t\t\t\t\tif (isCeiling) curVert.y += getWallHeight(curWallNode);\r\n\t\t\t\t\t\t\t\tcapGeom.attributes.position.setXYZ(wallIndex,curVert.x,curVert.y,curVert.z);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar shouldReverse = false;\r\n\t\t\t\t\t\t\tif (!isCeiling) shouldReverse = !shouldReverse;\r\n\t\t\t\t\t\t\tif (isOutside)  shouldReverse = !shouldReverse;\r\n\t\t\t\t\t\t\tif (shouldReverse) flipGeom(capGeom);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tmakePlaneUvs(capGeom,'x','z',isCeiling?1:-1,1);\r\n\t\t\t\t\t\t\tfinishGeom(capGeom);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (!curCapNode.myMeshes) curCapNode.myMeshes=[];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar typeLabel = isCeiling?\"ceiling\":\"floor\";\r\n\t\t\t\t\t\t\tvar myMat = curCapNode.components.material ? curCapNode.components.material.material : curCapNode.parentNode.components.material.material;\r\n\t\t\t\t\t\t\tif (curCapNode.myMeshes[typeLabel]) {\r\n\t\t\t\t\t\t\t\tcurCapNode.myMeshes[typeLabel].geometry = capGeom;\r\n\t\t\t\t\t\t\t\tcurCapNode.myMeshes[typeLabel].material = myMat;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcurCapNode.myMeshes[typeLabel] = new THREE.Mesh(capGeom, myMat);\r\n\t\t\t\t\t\t\t\tcurCapNode.setObject3D(typeLabel,curCapNode.myMeshes[typeLabel]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// generate the door tunnels' geometry:\r\n\t\t\t\r\n\t\t\tfor(var curDoorlinkElIndex=0; curDoorlinkElIndex<doorlinks.length; curDoorlinkElIndex++){\r\n\t\t\t\tvar curDoorlinkEl = doorlinks[curDoorlinkElIndex];\r\n\t\t\t\t\r\n\t\t\t\tvar curDoorlink = curDoorlinkEl.components.doorlink;\r\n\t\t\t\tif (!curDoorlink.data.from) continue;\r\n\t\t\t\tif (!curDoorlink.data.to) continue;\r\n\t\t\t\tif (!curDoorlink.data.from.myVerts) return;\r\n\t\t\t\tif (!curDoorlink.data.to.myVerts) return;\r\n\t\t\t\t\r\n\t\t\t\tfor(var doorLinkChildIndex=0; doorLinkChildIndex<curDoorlinkEl.children.length; doorLinkChildIndex++){\r\n\t\t\t\t\tvar doorLinkChild = curDoorlinkEl.children[doorLinkChildIndex];\r\n\t\t\t\t\tif (!doorLinkChild.components) continue;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar types=[\"sides\",\"floor\",\"ceiling\"];\r\n\t\t\t\t\tfor(var curTypeIndex=0; curTypeIndex<types.length; curTypeIndex++){\r\n\t\t\t\t\t\tvar curType = types[curTypeIndex];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (!doorLinkChild.components[curType]) continue;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar myMat = doorLinkChild.components.material?doorLinkChild.components.material.material:doorLinkChild.parentNode.components.material.material;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (!doorLinkChild.myGeoms) doorLinkChild.myGeoms=[];\r\n\t\t\t\t\t\tif (!doorLinkChild.myGeoms[curType]) {\r\n\t\t\t\t\t\t\tvar curGeom = new THREE.BufferGeometry();\r\n\t\t\t\t\t\t\tdoorLinkChild.myGeoms[curType] = curGeom;\r\n\t\t\t\t\t\t\tvar myMesh = new THREE.Mesh(\r\n\t\t\t\t\t\t\t\tcurGeom,\r\n\t\t\t\t\t\t\t\tmyMat\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tcurGeom.meshRef = myMesh;\r\n\t\t\t\t\t\t\tdoorLinkChild.setObject3D(curType,myMesh);\r\n\t\t\t\t\t\t\tvar indexArray = [];\r\n\t\t\t\t\t\t\tindexArray.push( 0,1,2, 1,3,2 );\r\n\t\t\t\t\t\t\tif (curType==\"sides\") indexArray.push( 4,5,6, 5,7,6 );\r\n\t\t\t\t\t\t\tcurGeom.setIndex(indexArray);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar curGeom = doorLinkChild.myGeoms[curType];\r\n\t\t\t\t\t\tcurGeom.meshRef.material = myMat;\r\n\t\t\t\t\t\tvar positionArray = [];\r\n\t\t\t\t\t\tfunction addWorldVertex(pt){\r\n\t\t\t\t\t\t\tvar localPt = pt.clone();\r\n\t\t\t\t\t\t\tdoorLinkChild.object3D.worldToLocal(localPt);\r\n\t\t\t\t\t\t\tpositionArray.push(localPt.x,localPt.y,localPt.z);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfunction commitVertices(){\r\n\t\t\t\t\t\t\tcurGeom.setAttribute('position',new THREE.BufferAttribute(new Float32Array(positionArray),3));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar fVerts=curDoorlink.data.from.myVerts;\r\n\t\t\t\t\t\tvar tVerts=curDoorlink.data.to.myVerts;\r\n\t\t\t\t\t\tswitch(curType){\r\n\t\t\t\t\t\t\tcase \"floor\":\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[0]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[2]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[2]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[0]);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tcommitVertices();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tmakeUvsForGeom(curGeom,function(pt,vertIndex){\r\n\t\t\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t\t\t1-(vertIndex%2),\r\n\t\t\t\t\t\t\t\t\t\t1-Math.floor(vertIndex/2)\r\n\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"ceiling\":\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[3]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[1]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[1]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[3]);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tcommitVertices();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tmakeUvsForGeom(curGeom,function(pt,vertIndex){\r\n\t\t\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t\t\tvertIndex%2,\r\n\t\t\t\t\t\t\t\t\t\t1-Math.floor(vertIndex/2)\r\n\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"sides\":\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[2]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[3]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[0]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[1]);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[2]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(fVerts[3]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[0]);\r\n\t\t\t\t\t\t\t\taddWorldVertex(tVerts[1]);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tcommitVertices();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tmakeUvsForGeom(curGeom,function(pt,vertIndex){\r\n\t\t\t\t\t\t\t\t\tvar uv = [];\r\n\t\t\t\t\t\t\t\t\tuv[0] = Math.floor(vertIndex/2);\r\n\t\t\t\t\t\t\t\t\tuv[1] = vertIndex%2;\r\n\t\t\t\t\t\t\t\t\tif (vertIndex<4) uv[0] = 1-uv[0];\r\n\t\t\t\t\t\t\t\t\treturn uv;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfinishGeom(curGeom);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//console.log(\" === RE-EVALUATION COMPLETE!\");\r\n\t\t\tbuildingSelf.dirty = false;\r\n\t\t\t\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction updateScene(lastScene){\r\n\tif (lastScene && lastScene.systems.building) lastScene.systems.building.reexamineBuilding();\r\n}\r\nfunction positionWatch(e){\r\n\tif (e.detail.name == \"position\") updateScene(e.detail.target.sceneEl);\r\n}\r\n\r\nfunction nodeSceneInit(){\r\n\tthis.lastScene = this.el.sceneEl;\r\n\tupdateScene(this.lastScene);\r\n\tthis.el.addEventListener('componentchanged',positionWatch);\r\n}\r\nfunction nodeSceneUpdate(){\r\n\tupdateScene(this.lastScene);\r\n}\r\nfunction nodeSceneRemove(){\r\n\tupdateScene(this.lastScene);\r\n\tthis.lastScene = null;\r\n\tthis.el.removeEventListener('componentchanged',positionWatch);\r\n}\r\n\r\n\r\nvar refreshSceneConfig = {\r\n\tinit:nodeSceneInit,\r\n\tupdate:nodeSceneUpdate,\r\n\tremove:nodeSceneRemove\r\n};\r\n\r\n\r\n\r\nAFRAME.registerComponent('room',Object.assign({\r\n\t\r\n\tschema:{\r\n\t\toutside:{type:'boolean'},\r\n\t\theight:{type:'number', default:2.4},\r\n\t\twidth:{type:'number'},\r\n\t\tlength:{type:'number'}\r\n\t},\r\n\t\r\n},refreshSceneConfig));\r\n\r\nAFRAME.registerComponent('wall',Object.assign({\r\n\t\r\n\tschema:{\r\n\t\theight:{type:'number'},\r\n\t}\r\n\t\r\n},refreshSceneConfig));\r\n\r\nAFRAME.registerComponent('floor',refreshSceneConfig);\r\nAFRAME.registerComponent('ceiling',refreshSceneConfig);\r\n\r\n\r\nAFRAME.registerComponent('doorhole',refreshSceneConfig);\r\n\r\nAFRAME.registerComponent('doorlink',Object.assign({\r\n\t\r\n\tschema:{\r\n\t\tfrom:{type:'selector'},\r\n\t\tto:{type:'selector'},\r\n\t\theight:{type:'number', default:2.0},\r\n\t\twidth:{type:'number', default:0.8}\r\n\t}\r\n\t\r\n},refreshSceneConfig));\r\n\r\nAFRAME.registerComponent('sides',refreshSceneConfig);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// could probably automate this rather than hard-coding it, but this'll do for now:\r\n\r\nAFRAME.registerPrimitive('rw-room',{\r\n\tdefaultComponents:{room:{}},\r\n\tmappings:{\r\n\t\toutside:'room.outside',\r\n\t\theight:'room.height',\r\n\t\twidth:'room.width',\r\n\t\tlength:'room.length'\r\n\t}\r\n});\r\n\r\nAFRAME.registerPrimitive('rw-wall',{\r\n\tdefaultComponents:{wall:{}},\r\n\tmappings:{\r\n\t\theight:'wall.height'\r\n\t}\r\n});\r\n\r\nAFRAME.registerPrimitive('rw-floor',{\r\n\tdefaultComponents:{floor:{}},\r\n\tmappings:{}\r\n});\r\n\r\nAFRAME.registerPrimitive('rw-ceiling',{\r\n\tdefaultComponents:{ceiling:{}},\r\n\tmappings:{}\r\n});\r\n\r\nAFRAME.registerPrimitive('rw-doorhole',{\r\n\tdefaultComponents:{doorhole:{}},\r\n\tmappings:{}\r\n});\r\n\r\nAFRAME.registerPrimitive('rw-doorlink',{\r\n\tdefaultComponents:{doorlink:{}},\r\n\tmappings:{\r\n\t\tfrom:'doorlink.from',\r\n\t\tto:'doorlink.to',\r\n\t\theight:'doorlink.height',\r\n\t\twidth:'doorlink.width',\r\n\t}\r\n});\r\n\r\nAFRAME.registerPrimitive('rw-sides',{\r\n\tdefaultComponents:{sides:{}},\r\n\tmappings:{}\r\n});\r\n\r\n\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHFDQUFxQztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGtEQUFrRDtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QiwyQkFBMkI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxlQUFlO0FBQzFCLFVBQVUsMkJBQTJCO0FBQ3JDLFNBQVMsY0FBYztBQUN2QixVQUFVO0FBQ1YsRUFBRTtBQUNGO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxjQUFjO0FBQ3hCO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLGdCQUFnQjtBQUN4QixNQUFNLGdCQUFnQjtBQUN0QixVQUFVLDJCQUEyQjtBQUNyQyxTQUFTO0FBQ1Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLFFBQVE7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxvQkFBb0IsUUFBUTtBQUM1QjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLG9CQUFvQixTQUFTO0FBQzdCO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxvQkFBb0IsV0FBVztBQUMvQjtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0Esb0JBQW9CLFlBQVk7QUFDaEM7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLG9CQUFvQixZQUFZO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0Esb0JBQW9CLFNBQVM7QUFDN0I7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2FmcmFtZS1yb29tLWNvbXBvbmVudC8uL2luZGV4LmpzPzQxZjUiXSwic291cmNlc0NvbnRlbnQiOlsiQUZSQU1FLnJlZ2lzdGVyU3lzdGVtKCdidWlsZGluZycse1xyXG5cdFxyXG5cdHJlZXhhbWluZUJ1aWxkaW5nOmZ1bmN0aW9uKCl7XHJcblx0XHRcclxuXHRcdC8vY29uc29sZS5sb2coXCIgPSBSRUVWQUxVQVRJT04gUkVRVUVTVEVELi4uXCIpO1xyXG5cdFx0XHJcblx0XHR2YXIgYnVpbGRpbmdTZWxmID0gdGhpcztcclxuXHRcdHZhciBIQUlSID0gMC4wMDAxO1xyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0LypcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdGh0dHBzOi8vZ2l0aHViLmNvbS9vbWdpdHNyYXZlbi9hZnJhbWUtcm9vbS1jb21wb25lbnRcclxuXHRcdHYwLjQuMlxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0T1BUSU1JWkFUSU9OOlxyXG5cdFx0XHJcblx0XHRjdXJyZW50bHksIHRoZSBlbnRpcmUgYnVpbGRpbmcgaXMgZ2V0dGluZyByZS1nZW5lcmF0ZWQgZnJvbSBzY3JhdGNoIGFueSB0aW1lIGFueXRoaW5nIGluIGl0IGNoYW5nZXMuXHJcblx0XHRvYnZpb3VzbHkgdGhpcyBpcyB3YXN0ZWZ1bCwgYnV0OlxyXG5cdFx0LSB0aGlzIGxpYnJhcnkgaXNuJ3QgcGFydGljdWxhcmx5IGxpa2VseSB0byBiZSB1c2VkIGluIGEgY29udGV4dCB3aGVyZSB0aGVzZSBwcm9wZXJ0aWVzIHdpbGwgYmUgY2hhbmdpbmcgYXQgcnVudGltZSAoYXQgbGVhc3Qgb3V0c2lkZSBvZiBkZWJ1Z2dpbmcpXHJcblx0XHQtIHJpZ2h0IG5vdyBJIGFtIG1vcmUgY29uY2VybmVkIHdpdGggZ2V0dGluZyBpdCBvdXQgdGhlIGRvb3IgdGhhbiBtYWtpbmcgaXQgcGVyZmVjdCBhbnl3YXlcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0UExBTk5FRCBGRUFUVVJFUyBUTyBDT01FIChpbiBvcmRlcik6XHJcblx0XHQtIGdyZWF0ZXIgY29udHJvbCBvdmVyIFVWIGdlbmVyYXRpb25cclxuXHRcdC0gYXV0b21hdGljIGNvbGxpc2lvbiBhc3NpZ25tZW50XHJcblx0XHQtIGRvb3JzIGxpZnRlZCBhYm92ZSB0aGUgZ3JvdW5kIChpLmUuIHdpbmRvd3MpXHJcblx0XHQtIGFjY2VwdCBhIHNoYXBlIHRvIGJlIGV4dHJ1ZGVkIGFyb3VuZCBhIGRvb3Job2xlIHRvIG1ha2UgYSBkb29yZnJhbWUgKCYgYXJvdW5kIGEgZmxvb3IgdG8gbWFrZSBhIGJhc2Vib2FyZClcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0S05PV04gSVNTVUVTICh3aXRoIG5vIG9idmlvdXMgc29sdXRpb24gdGhhdCB3b3VsZCBwcmVzZXJ2ZSBlYXNlIG9mIHVzZSk6XHJcblx0XHQtIGZsb29yL2NlaWxpbmcgdHJpYW5ndWxhdGlvbiBpcyBub3QgY29udHJvbGxhYmxlIChhbmQgdGhlcmVmb3JlIHZhcnlpbmcgd2FsbCB2ZXJ0aWNhbGl0eSBpcyBuZWFybHkgdXNlbGVzcyB1bmxlc3Mgc2xvcGUgaXMgY29uc2lzdGVudClcclxuXHRcdC0gZG9vcmhvbGUgcGFyZW50aW5nIGlzIGFsd2F5cyBsZXZlbCB0byB0aGUgaG9yaXpvbiBldmVuIG9uIHNsb3BlLWZsb29yZWQgd2FsbHNcclxuXHRcdC0gdGhlIHNldFRpbWVvdXQgdGhpbmcgcmVzdWx0cyBpbiBhIG9uZS1mcmFtZSBmbGFzaCBvZiBpbnZpc2libGUgd2FsbHM6IGlzIGl0IHdvcnRoIGl0PyAoaXMgdGhlcmUgYSBzbWFydGVyIHRoaW5nIHRvIGxpc3RlbiBmb3IsIG1heWJlPylcclxuXHRcdFxyXG5cdFx0SVNTVUVTIFRIQVQgQ09VTEQgVEhFT1JFVElDQUxMWSBCRSBGSVhFRCBCVVQgRE9OJ1QgU0VFTSBXT1JUSCBUSEUgVFJPVUJMRTpcclxuXHRcdC0gd2FsbHMgYXJlIGludGVybmFsbHkgcmVhcnJhbmdlZCB0byBhbHdheXMgd2luZCBDVywgd2hpY2ggbWVhbnMgd2FsbCBwYXJlbnRpbmcgd2lsbCBwb2ludCB0b3dhcmRzIHRoZSBcInByZXZpb3VzXCIgd2FsbCBpZiB5b3UgZW50ZXJlZCB0aGVtIGluIENDVyBvcmRlclxyXG5cdFx0XHJcblx0XHQqL1xyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gZmxpcEdlb20oZ2VvbSl7XHJcblx0XHRcdGNvbnN0IGluZGljZXMgPSBnZW9tLmdldEluZGV4KCkuYXJyYXk7XHJcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaW5kaWNlcy5sZW5ndGg7IGkgKz0gMykge1xyXG5cdFx0XHRcdGNvbnN0IHRlbXBJbmRleCA9IGluZGljZXNbaSArIDJdO1xyXG5cdFx0XHRcdGluZGljZXNbaSArIDJdID0gaW5kaWNlc1tpICsgMV07XHJcblx0XHRcdFx0aW5kaWNlc1tpICsgMV0gPSB0ZW1wSW5kZXg7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGdlb20uZ2V0SW5kZXgoKS5uZWVkc1VwZGF0ZSA9IHRydWU7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIG1ha2VVdnNGb3JHZW9tKGdlb20sY2FsbGJhY2spe1xyXG5cdFx0XHR2YXIgYWxsVVZzID0gW107XHJcblx0XHRcdGZvcih2YXIgZmFjZVZlcnRJbmRleD0wOyBmYWNlVmVydEluZGV4PGdlb20uaW5kZXguYXJyYXkubGVuZ3RoOyBmYWNlVmVydEluZGV4Kyspe1xyXG5cdFx0XHRcdHZhciB2ZXJ0ZXhJbmRleCA9IGdlb20uaW5kZXguYXJyYXlbZmFjZVZlcnRJbmRleF07XHJcblx0XHRcdFx0dmFyIHZlcnRleCA9IG5ldyBUSFJFRS5WZWN0b3IzKFxyXG5cdFx0XHRcdFx0Z2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmdldFgodmVydGV4SW5kZXgpLFxyXG5cdFx0XHRcdFx0Z2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmdldFkodmVydGV4SW5kZXgpLFxyXG5cdFx0XHRcdFx0Z2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmdldFoodmVydGV4SW5kZXgpXHJcblx0XHRcdFx0KTtcclxuXHRcdFx0XHR2YXIgdXYgPSBjYWxsYmFjayh2ZXJ0ZXgsZmFjZVZlcnRJbmRleCUzKTtcclxuXHRcdFx0XHRhbGxVVnNbdmVydGV4SW5kZXgqMiswXSA9IHV2WzBdO1xyXG5cdFx0XHRcdGFsbFVWc1t2ZXJ0ZXhJbmRleCoyKzFdID0gdXZbMV07XHJcblx0XHRcdH1cclxuXHRcdFx0Z2VvbS5zZXRBdHRyaWJ1dGUoJ3V2JyxuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKG5ldyBGbG9hdDMyQXJyYXkoYWxsVVZzKSwyKSk7XHJcblx0XHRcdGdlb20udXZzTmVlZFVwZGF0ZSA9IHRydWU7XHJcblx0XHRcdFxyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gbWFrZVBsYW5lVXZzKGdlb20sdUtleSx2S2V5LHVNdWx0LHZNdWx0KXtcclxuXHRcdFx0bWFrZVV2c0Zvckdlb20oZ2VvbSxmdW5jdGlvbihwdCl7XHJcblx0XHRcdFx0cmV0dXJuIFtcclxuXHRcdFx0XHRcdHB0W3VLZXldKnVNdWx0LFxyXG5cdFx0XHRcdFx0cHRbdktleV0qdk11bHRcclxuXHRcdFx0XHRdO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gZmluaXNoR2VvbShnZW9tKXtcclxuXHRcdFx0Z2VvbS5jb21wdXRlVmVydGV4Tm9ybWFscygpO1xyXG5cdFx0XHQvLyBhcmUgdGhlc2UgbmVjZXNzYXJ5P1xyXG5cdFx0XHRnZW9tLmNvbXB1dGVCb3VuZGluZ0JveCgpO1xyXG5cdFx0XHRnZW9tLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIGdldFVuc29ydGVkUm9vbVdhbGxBcnJheShyb29tRWwpe1xyXG5cdFx0XHR2YXIgd2FsbHM9W107XHJcblx0XHRcdGZvcih2YXIgcm9vbUNoaWxkTm9kZUluZGV4PTA7IHJvb21DaGlsZE5vZGVJbmRleDxyb29tRWwuY2hpbGRyZW4ubGVuZ3RoOyByb29tQ2hpbGROb2RlSW5kZXgrKyl7XHJcblx0XHRcdFx0dmFyIHJvb21DaGlsZE5vZGUgPSByb29tRWwuY2hpbGRyZW5bcm9vbUNoaWxkTm9kZUluZGV4XTtcclxuXHRcdFx0XHRpZiAocm9vbUNoaWxkTm9kZS5jb21wb25lbnRzLndhbGwpIHdhbGxzLnB1c2gocm9vbUNoaWxkTm9kZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHdhbGxzO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBnZXRSb29tV2FsbEFycmF5KHJvb21FbCl7XHJcblx0XHRcdFxyXG5cdFx0XHQvLyB0aGUgcmVzdWx0cyBvZiB0aGlzIG5vdCBiZWluZyBzYXZlZCBhbnl3aGVyZSBpcyBzdXBlciB3YXN0ZWZ1bCxcclxuXHRcdFx0Ly8gYnV0LCBzZWUgYWJvdmU7IG5vdCB3b3J0aCB3b3JyeWluZyBhYm91dCB5ZXRcclxuXHRcdFx0XHJcblx0XHRcdHZhciBpc091dHNpZGUgPSByb29tRWwuY29tcG9uZW50cy5yb29tLmRhdGEub3V0c2lkZTtcclxuXHRcdFx0XHJcblx0XHRcdHZhciB3YWxscyA9IGdldFVuc29ydGVkUm9vbVdhbGxBcnJheShyb29tRWwpO1xyXG5cdFx0XHRcclxuXHRcdFx0dmFyIGN3U3VtPTA7XHJcblx0XHRcdGZvcih2YXIgd2FsbEluZGV4PTA7IHdhbGxJbmRleDx3YWxscy5sZW5ndGg7IHdhbGxJbmRleCsrKXtcclxuXHRcdFx0XHR2YXIgY3VyV2FsbE5vZGUgPSB3YWxsc1t3YWxsSW5kZXhdO1xyXG5cdFx0XHRcdHZhciBuZXh0V2FsbE5vZGUgPSB3YWxsc1sod2FsbEluZGV4KzEpJXdhbGxzLmxlbmd0aF07XHJcblx0XHRcdFx0dmFyIGN1cldhbGxQb3MgPSBjdXJXYWxsTm9kZS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGE7XHJcblx0XHRcdFx0dmFyIG5leHRXYWxsUG9zID0gbmV4dFdhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRjd1N1bSArPSAobmV4dFdhbGxQb3MueCAtIGN1cldhbGxQb3MueCkgKiAobmV4dFdhbGxQb3MueiArIGN1cldhbGxQb3Mueik7XHJcblx0XHRcdFx0XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdHZhciBzaG91bGRSZXZlcnNlID0gZmFsc2U7XHJcblx0XHRcdGlmIChjd1N1bSA+IDApIHNob3VsZFJldmVyc2UgPSAhc2hvdWxkUmV2ZXJzZTtcclxuXHRcdFx0aWYgKGlzT3V0c2lkZSkgc2hvdWxkUmV2ZXJzZSA9ICFzaG91bGRSZXZlcnNlO1xyXG5cdFx0XHRpZiAoc2hvdWxkUmV2ZXJzZSkgd2FsbHMucmV2ZXJzZSgpO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIHdhbGxzO1xyXG5cdFx0XHRcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIGdldE5leHRXYWxsRWwod2FsbEVsKXtcclxuXHRcdFx0dmFyIHdhbGxMaXN0ID0gZ2V0Um9vbVdhbGxBcnJheSh3YWxsRWwucGFyZW50Tm9kZSk7XHJcblx0XHRcdHZhciBjdXJXYWxsSW5kZXggPSB3YWxsTGlzdC5pbmRleE9mKHdhbGxFbCk7XHJcblx0XHRcdHJldHVybiB3YWxsTGlzdFsoY3VyV2FsbEluZGV4KzEpJXdhbGxMaXN0Lmxlbmd0aF07XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHZhciB3b3JsZFdhbGxQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHdvcmxkTmV4dFBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgd29ybGRMaW5rUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdGZ1bmN0aW9uIG1vdmVGb3JMaW5rKGRvb3Job2xlRWwsZG9vcmxpbmtFbCl7XHJcblx0XHRcdFxyXG5cdFx0XHR2YXIgaG9sZVdhbGxFbCA9IGRvb3Job2xlRWwucGFyZW50Tm9kZTtcclxuXHRcdFx0dmFyIG5leHRXYWxsRWwgPSBnZXROZXh0V2FsbEVsKGhvbGVXYWxsRWwpO1xyXG5cdFx0XHRpZiAoIW5leHRXYWxsRWwpIHJldHVybjtcclxuXHRcdFx0XHJcblx0XHRcdGhvbGVXYWxsRWwub2JqZWN0M0QuZ2V0V29ybGRQb3NpdGlvbih3b3JsZFdhbGxQb3MpO1xyXG5cdFx0XHRuZXh0V2FsbEVsLm9iamVjdDNELmdldFdvcmxkUG9zaXRpb24od29ybGROZXh0UG9zKTtcclxuXHRcdFx0ZG9vcmxpbmtFbC5vYmplY3QzRC5nZXRXb3JsZFBvc2l0aW9uKHdvcmxkTGlua1Bvcyk7XHJcblx0XHRcdFxyXG5cdFx0XHR2YXIgbGlua0dhcFggPSB3b3JsZExpbmtQb3MueCAtIHdvcmxkV2FsbFBvcy54O1xyXG5cdFx0XHR2YXIgbGlua0dhcFogPSB3b3JsZExpbmtQb3MueiAtIHdvcmxkV2FsbFBvcy56O1xyXG5cdFx0XHRcclxuXHRcdFx0dmFyIHdhbGxHYXBYID0gd29ybGROZXh0UG9zLnggLSB3b3JsZFdhbGxQb3MueDtcclxuXHRcdFx0dmFyIHdhbGxHYXBaID0gd29ybGROZXh0UG9zLnogLSB3b3JsZFdhbGxQb3MuejtcclxuXHRcdFx0dmFyIHdhbGxBbmcgPSBNYXRoLmF0YW4yKHdhbGxHYXBaLHdhbGxHYXBYKTtcclxuXHRcdFx0dmFyIHdhbGxMZW5ndGggPSBNYXRoLnNxcnQod2FsbEdhcFgqd2FsbEdhcFggKyB3YWxsR2FwWip3YWxsR2FwWik7XHJcblx0XHRcdFxyXG5cdFx0XHR2YXIgbG9jYWxMaW5rWCA9IGxpbmtHYXBYKk1hdGguY29zKC13YWxsQW5nKSAtIGxpbmtHYXBaKk1hdGguc2luKC13YWxsQW5nKTtcclxuXHRcdFx0Ly92YXIgbG9jYWxMaW5rWiA9IGxpbmtHYXBYKk1hdGguc2luKC13YWxsQW5nKSArIGxpbmtHYXBaKk1hdGguY29zKC13YWxsQW5nKTtcclxuXHRcdFx0XHJcblx0XHRcdHZhciBkb29ySGFsZiA9IGRvb3JsaW5rRWwuY29tcG9uZW50cy5kb29ybGluay5kYXRhLndpZHRoIC8gMjtcclxuXHRcdFx0bG9jYWxMaW5rWCA9IE1hdGgubWF4KGxvY2FsTGlua1gsZG9vckhhbGYrSEFJUik7XHJcblx0XHRcdGxvY2FsTGlua1ggPSBNYXRoLm1pbihsb2NhbExpbmtYLHdhbGxMZW5ndGgtZG9vckhhbGYtSEFJUik7XHJcblx0XHRcdFxyXG5cdFx0XHRkb29yaG9sZUVsLnNldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIse3g6bG9jYWxMaW5rWCx5OjAsejowfSk7XHJcblx0XHRcdGRvb3Job2xlRWwub2JqZWN0M0QudXBkYXRlTWF0cml4V29ybGQoKTtcclxuXHRcdFx0XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIGdldEhvbGVMaW5rKGRvb3Job2xlRWwpe1xyXG5cdFx0XHR2YXIgZG9vcmxpbmtzID0gYnVpbGRpbmdTZWxmLmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkb29ybGlua10nKTtcclxuXHRcdFx0Zm9yKHZhciBjdXJMaW5rSW5kZXg9MDsgY3VyTGlua0luZGV4PGRvb3JsaW5rcy5sZW5ndGg7IGN1ckxpbmtJbmRleCsrKXtcclxuXHRcdFx0XHR2YXIgY3VyTGluayA9IGRvb3JsaW5rc1tjdXJMaW5rSW5kZXhdO1xyXG5cdFx0XHRcdGlmIChjdXJMaW5rLmNvbXBvbmVudHMuZG9vcmxpbmsuZGF0YS5mcm9tID09IGRvb3Job2xlRWwpIHJldHVybiBjdXJMaW5rO1xyXG5cdFx0XHRcdGlmIChjdXJMaW5rLmNvbXBvbmVudHMuZG9vcmxpbmsuZGF0YS50byAgID09IGRvb3Job2xlRWwpIHJldHVybiBjdXJMaW5rO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIGdldFdhbGxIZWlnaHQod2FsbEVsKXtcclxuXHRcdFx0aWYgKHdhbGxFbC5jb21wb25lbnRzLndhbGwuZGF0YS5oZWlnaHQpIHJldHVybiB3YWxsRWwuY29tcG9uZW50cy53YWxsLmRhdGEuaGVpZ2h0O1xyXG5cdFx0XHRyZXR1cm4gd2FsbEVsLnBhcmVudE5vZGUuY29tcG9uZW50cy5yb29tLmRhdGEuaGVpZ2h0O1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRpZiAoYnVpbGRpbmdTZWxmLmRpcnR5KSByZXR1cm47XHJcblx0XHRidWlsZGluZ1NlbGYuZGlydHkgPSB0cnVlO1xyXG5cdFx0c2V0VGltZW91dChmdW5jdGlvbigpe1xyXG5cdFx0XHRcclxuXHRcdFx0Ly9jb25zb2xlLmxvZyhcIiA9PSBTVEFSVElORyBSRS1FVkFMVUFUSU9OLi4uXCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0Ly8gc2lsbHkgYnV0IG5lY2Vzc2FyeSBiZWNhdXNlIG9mIHRocmVlSlMgd2VpcmRuZXNzXHJcblx0XHRcdGJ1aWxkaW5nU2VsZi5lbC5vYmplY3QzRC51cGRhdGVNYXRyaXhXb3JsZCgpO1xyXG5cdFx0XHRcclxuXHRcdFx0XHJcblx0XHRcdFxyXG5cdFx0XHRcclxuXHRcdFx0XHJcblx0XHRcdC8vIGxheSBvdXQgd2FsbHMnIGFuZ2xlczpcclxuXHRcdFx0XHJcblx0XHRcdGZvcih2YXIgc2NlbmVDaGlsZE5vZGVJbmRleD0wOyBzY2VuZUNoaWxkTm9kZUluZGV4PGJ1aWxkaW5nU2VsZi5lbC5jaGlsZHJlbi5sZW5ndGg7IHNjZW5lQ2hpbGROb2RlSW5kZXgrKyl7XHJcblx0XHRcdFx0dmFyIHNjZW5lQ2hpbGROb2RlID0gYnVpbGRpbmdTZWxmLmVsLmNoaWxkcmVuW3NjZW5lQ2hpbGROb2RlSW5kZXhdO1xyXG5cdFx0XHRcdGlmIChzY2VuZUNoaWxkTm9kZS5jb21wb25lbnRzICYmIHNjZW5lQ2hpbGROb2RlLmNvbXBvbmVudHMucm9vbSkge1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHZhciB3ID0gc2NlbmVDaGlsZE5vZGUuY29tcG9uZW50cy5yb29tLmRhdGEud2lkdGg7XHJcblx0XHRcdFx0XHR2YXIgbCA9IHNjZW5lQ2hpbGROb2RlLmNvbXBvbmVudHMucm9vbS5kYXRhLmxlbmd0aDtcclxuXHRcdFx0XHRcdGlmICh3IHx8IGwpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHcgJiYgbCkge1xyXG5cdFx0XHRcdFx0XHRcdHZhciByYXdXYWxscyA9IGdldFVuc29ydGVkUm9vbVdhbGxBcnJheShzY2VuZUNoaWxkTm9kZSk7XHJcblx0XHRcdFx0XHRcdFx0aWYgKHJhd1dhbGxzLmxlbmd0aCA+PSA0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAocmF3V2FsbHMubGVuZ3RoID4gNCkgY29uc29sZS5lcnJvcihcInJvb21zIHdpdGggV0lEVEggYW5kIExFTkdUSCBzaG91bGQgb25seSBoYXZlIGZvdXIgd2FsbHMhXCIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0cmF3V2FsbHNbMF0uc2V0QXR0cmlidXRlKFwicG9zaXRpb25cIix7eDowLHk6MCx6OjB9KTtcclxuXHRcdFx0XHRcdFx0XHRcdHJhd1dhbGxzWzFdLnNldEF0dHJpYnV0ZShcInBvc2l0aW9uXCIse3g6dyx5OjAsejowfSk7XHJcblx0XHRcdFx0XHRcdFx0XHRyYXdXYWxsc1syXS5zZXRBdHRyaWJ1dGUoXCJwb3NpdGlvblwiLHt4OncseTowLHo6bH0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0cmF3V2FsbHNbM10uc2V0QXR0cmlidXRlKFwicG9zaXRpb25cIix7eDowLHk6MCx6Omx9KTtcclxuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcInJvb21zIHdpdGggV0lEVEggYW5kIExFTkdUSCBtdXN0IGhhdmUgZm91ciB3YWxscyFcIik7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJyb29tcyB3aXRoIFdJRFRIIG11c3QgYWxzbyBoYXZlIExFTkdUSCAoYW5kIHZpY2UgdmVyc2EpXCIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0dmFyIHdhbGxzPWdldFJvb21XYWxsQXJyYXkoc2NlbmVDaGlsZE5vZGUpO1xyXG5cdFx0XHRcdFx0aWYgKHdhbGxzLmxlbmd0aCA+IDIpIHtcclxuXHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdGZvcih2YXIgd2FsbEluZGV4PTA7IHdhbGxJbmRleDx3YWxscy5sZW5ndGg7IHdhbGxJbmRleCsrKXtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY3VyV2FsbE5vZGUgPSB3YWxsc1t3YWxsSW5kZXhdO1xyXG5cdFx0XHRcdFx0XHRcdHZhciBuZXh0V2FsbE5vZGUgPSB3YWxsc1sod2FsbEluZGV4KzEpJXdhbGxzLmxlbmd0aF07XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0dmFyIHdhbGxHYXBYID0gbmV4dFdhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS54IC0gY3VyV2FsbE5vZGUuY29tcG9uZW50cy5wb3NpdGlvbi5kYXRhLng7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHdhbGxHYXBaID0gbmV4dFdhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS56IC0gY3VyV2FsbE5vZGUuY29tcG9uZW50cy5wb3NpdGlvbi5kYXRhLno7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHdhbGxBbmcgPSBNYXRoLmF0YW4yKHdhbGxHYXBaLHdhbGxHYXBYKTtcclxuXHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRjdXJXYWxsTm9kZS5zZXRBdHRyaWJ1dGUoXCJyb3RhdGlvblwiLHt4OjAseTotd2FsbEFuZy9NYXRoLlBJKjE4MCx6OjB9KTtcclxuXHRcdFx0XHRcdFx0XHRjdXJXYWxsTm9kZS5vYmplY3QzRC51cGRhdGVNYXRyaXhXb3JsZCgpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRcclxuXHRcdFx0XHJcblx0XHRcdC8vIHBvc2l0aW9uIHRoZSBkb29yIGhvbGVzOlxyXG5cdFx0XHRcclxuXHRcdFx0dmFyIGRvb3JsaW5rcyA9IGJ1aWxkaW5nU2VsZi5lbC5xdWVyeVNlbGVjdG9yQWxsKCdbZG9vcmxpbmtdJyk7XHJcblx0XHRcdGZvcih2YXIgY3VyRG9vcmxpbmtFbEluZGV4PTA7IGN1ckRvb3JsaW5rRWxJbmRleDxkb29ybGlua3MubGVuZ3RoOyBjdXJEb29ybGlua0VsSW5kZXgrKyl7XHJcblx0XHRcdFx0dmFyIGN1ckRvb3JsaW5rRWwgPSBkb29ybGlua3NbY3VyRG9vcmxpbmtFbEluZGV4XTtcclxuXHRcdFx0XHR2YXIgY3VyRG9vcmxpbmsgPSBjdXJEb29ybGlua0VsLmNvbXBvbmVudHMuZG9vcmxpbms7XHJcblx0XHRcdFx0aWYgKCFjdXJEb29ybGluaykgcmV0dXJuOy8vc3RpbGwgc2V0dGluZyB1cCwgdHJ5IGFnYWluIGxhdGVyXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0bW92ZUZvckxpbmsoY3VyRG9vcmxpbmsuZGF0YS5mcm9tLGN1ckRvb3JsaW5rLmVsKTtcclxuXHRcdFx0XHRtb3ZlRm9yTGluayhjdXJEb29ybGluay5kYXRhLnRvLGN1ckRvb3JsaW5rLmVsKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0XHJcblx0XHRcdFxyXG5cdFx0XHQvLyBnZW5lcmF0ZSB0aGUgd2FsbHMnIGdlb21ldHJ5OlxyXG5cdFx0XHRcclxuXHRcdFx0Zm9yKHZhciBzY2VuZUNoaWxkTm9kZUluZGV4PTA7IHNjZW5lQ2hpbGROb2RlSW5kZXg8YnVpbGRpbmdTZWxmLmVsLmNoaWxkcmVuLmxlbmd0aDsgc2NlbmVDaGlsZE5vZGVJbmRleCsrKXtcclxuXHRcdFx0XHR2YXIgc2NlbmVDaGlsZE5vZGUgPSBidWlsZGluZ1NlbGYuZWwuY2hpbGRyZW5bc2NlbmVDaGlsZE5vZGVJbmRleF07XHJcblx0XHRcdFx0aWYgKHNjZW5lQ2hpbGROb2RlLmNvbXBvbmVudHMgJiYgc2NlbmVDaGlsZE5vZGUuY29tcG9uZW50cy5yb29tKSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHR2YXIgaXNPdXRzaWRlID0gc2NlbmVDaGlsZE5vZGUuY29tcG9uZW50cy5yb29tLmRhdGEub3V0c2lkZTtcclxuXHRcdFx0XHRcdHZhciB3YWxscz1nZXRSb29tV2FsbEFycmF5KHNjZW5lQ2hpbGROb2RlKTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0aWYgKHdhbGxzLmxlbmd0aCA+IDIpIHtcclxuXHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRmb3IodmFyIHdhbGxJbmRleD0wOyB3YWxsSW5kZXg8d2FsbHMubGVuZ3RoOyB3YWxsSW5kZXgrKyl7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGN1cldhbGxOb2RlID0gd2FsbHNbd2FsbEluZGV4XTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbmV4dFdhbGxOb2RlID0gd2FsbHNbKHdhbGxJbmRleCsxKSV3YWxscy5sZW5ndGhdO1xyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdHZhciB3YWxsR2FwWCA9IG5leHRXYWxsTm9kZS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGEueCAtIGN1cldhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS54O1xyXG5cdFx0XHRcdFx0XHRcdHZhciB3YWxsR2FwWiA9IG5leHRXYWxsTm9kZS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGEueiAtIGN1cldhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS56O1xyXG5cdFx0XHRcdFx0XHRcdHZhciB3YWxsTGVuZ3RoID0gTWF0aC5zcXJ0KHdhbGxHYXBYKndhbGxHYXBYICsgd2FsbEdhcFoqd2FsbEdhcFopO1xyXG5cdFx0XHRcdFx0XHRcdHZhciB3YWxsQW5nID0gTWF0aC5hdGFuMih3YWxsR2FwWix3YWxsR2FwWCk7XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0dmFyIHdhbGxHYXBZID0gbmV4dFdhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS55IC0gY3VyV2FsbE5vZGUuY29tcG9uZW50cy5wb3NpdGlvbi5kYXRhLnk7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGhlaWdodEdhcCA9IGdldFdhbGxIZWlnaHQobmV4dFdhbGxOb2RlKSAtIGdldFdhbGxIZWlnaHQoY3VyV2FsbE5vZGUpO1xyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdHZhciBvcmRlcmVkSG9sZXM9W107XHJcblx0XHRcdFx0XHRcdFx0Zm9yKHZhciB3YWxsQ2hpbGROb2RlSW5kZXg9MDsgd2FsbENoaWxkTm9kZUluZGV4PGN1cldhbGxOb2RlLmNoaWxkcmVuLmxlbmd0aDsgd2FsbENoaWxkTm9kZUluZGV4Kyspe1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIHdhbGxDaGlsZE5vZGUgPSBjdXJXYWxsTm9kZS5jaGlsZHJlblt3YWxsQ2hpbGROb2RlSW5kZXhdO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHdhbGxDaGlsZE5vZGUuY29tcG9uZW50cyAmJiB3YWxsQ2hpbGROb2RlLmNvbXBvbmVudHMuZG9vcmhvbGUpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0b3JkZXJlZEhvbGVzLnB1c2god2FsbENoaWxkTm9kZSk7XHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdG9yZGVyZWRIb2xlcy5zb3J0KGZ1bmN0aW9uKGEsYil7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gYS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGEueCAtIGIuY29tcG9uZW50cy5wb3NpdGlvbi5kYXRhLng7XHJcblx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0dmFyIHdhbGxTaGFwZSA9IG5ldyBUSFJFRS5TaGFwZSgpO1xyXG5cdFx0XHRcdFx0XHRcdHdhbGxTaGFwZS5tb3ZlVG8oXHJcblx0XHRcdFx0XHRcdFx0XHQwLFxyXG5cdFx0XHRcdFx0XHRcdFx0Z2V0V2FsbEhlaWdodChjdXJXYWxsTm9kZSlcclxuXHRcdFx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdFx0XHRcdHdhbGxTaGFwZS5saW5lVG8oXHJcblx0XHRcdFx0XHRcdFx0XHQwLFxyXG5cdFx0XHRcdFx0XHRcdFx0MFxyXG5cdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0Zm9yKHZhciBob2xlSW5kZXg9MDsgaG9sZUluZGV4PG9yZGVyZWRIb2xlcy5sZW5ndGg7IGhvbGVJbmRleCsrKXtcclxuXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGhvbGVFbCA9IG9yZGVyZWRIb2xlc1tob2xlSW5kZXhdO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFob2xlRWwubXlWZXJ0cykgaG9sZUVsLm15VmVydHMgPSBbXTtcclxuXHRcdFx0XHRcdFx0XHRcdGhvbGVFbC5teVZlcnRzLmxlbmd0aD0wO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgbGlua0VsID0gZ2V0SG9sZUxpbmsob3JkZXJlZEhvbGVzW2hvbGVJbmRleF0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCFsaW5rRWwpIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgaG9sZUluZm8gPSBob2xlRWwuY29tcG9uZW50cztcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBsaW5rSW5mbyA9IGxpbmtFbC5jb21wb25lbnRzO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRmb3IodmFyIGhvbGVTaWRlPS0xOyBob2xlU2lkZTw9MTsgaG9sZVNpZGUrPTIpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgcHRYID0gaG9sZUluZm8ucG9zaXRpb24uZGF0YS54ICsgbGlua0luZm8uZG9vcmxpbmsuZGF0YS53aWR0aC8yKmhvbGVTaWRlO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgZmxvb3JZID0gKHB0WC93YWxsTGVuZ3RoKSp3YWxsR2FwWTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIHRvcFkgPSBmbG9vclkgKyBsaW5rSW5mby5kb29ybGluay5kYXRhLmhlaWdodDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBjdXJDZWlsID0gZ2V0V2FsbEhlaWdodChjdXJXYWxsTm9kZSkgKyAocHRYL3dhbGxMZW5ndGgpKmhlaWdodEdhcDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG1heFRvcFkgPSBmbG9vclkgKyBjdXJDZWlsIC0gSEFJUjsvL3dpbGwgYWx3YXlzIGJlIGEgc2VhbSwgYnV0LCBJJ20gbm90IGJvdGhlcmluZyB0byByZXdyaXRlIGp1c3QgZm9yIHRoYXRcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHRvcFkgPiBtYXhUb3BZKSB0b3BZID0gbWF4VG9wWTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdGZ1bmN0aW9uIGFkZFdvcmxkVmVydChwdFkpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciB0ZW1wUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMocHRYLHB0WSwwKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRjdXJXYWxsTm9kZS5vYmplY3QzRC5sb2NhbFRvV29ybGQodGVtcFBvcyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aG9sZUVsLm15VmVydHMucHVzaCh0ZW1wUG9zKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnQoZmxvb3JZKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0YWRkV29ybGRWZXJ0KHRvcFkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGhvbGVTaWRlIDwgMCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHdhbGxTaGFwZS5saW5lVG8ocHRYLGZsb29yWSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0d2FsbFNoYXBlLmxpbmVUbyhwdFgsdG9wWSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0d2FsbFNoYXBlLmxpbmVUbyhwdFgsdG9wWSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0d2FsbFNoYXBlLmxpbmVUbyhwdFgsZmxvb3JZKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdHdhbGxTaGFwZS5saW5lVG8oXHJcblx0XHRcdFx0XHRcdFx0XHR3YWxsTGVuZ3RoLFxyXG5cdFx0XHRcdFx0XHRcdFx0bmV4dFdhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS55LWN1cldhbGxOb2RlLmNvbXBvbmVudHMucG9zaXRpb24uZGF0YS55XHJcblx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHR3YWxsU2hhcGUubGluZVRvKFxyXG5cdFx0XHRcdFx0XHRcdFx0d2FsbExlbmd0aCxcclxuXHRcdFx0XHRcdFx0XHRcdChuZXh0V2FsbE5vZGUuY29tcG9uZW50cy5wb3NpdGlvbi5kYXRhLnktY3VyV2FsbE5vZGUuY29tcG9uZW50cy5wb3NpdGlvbi5kYXRhLnkpK2dldFdhbGxIZWlnaHQobmV4dFdhbGxOb2RlKVxyXG5cdFx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0dmFyIHdhbGxHZW9tID0gbmV3IFRIUkVFLlNoYXBlR2VvbWV0cnkod2FsbFNoYXBlKTtcclxuXHRcdFx0XHRcdFx0XHRtYWtlUGxhbmVVdnMod2FsbEdlb20sJ3gnLCd5JywxLDEpO1xyXG5cdFx0XHRcdFx0XHRcdGZpbmlzaEdlb20od2FsbEdlb20pO1xyXG5cdFx0XHRcdFx0XHRcdHZhciBteU1hdCA9IGN1cldhbGxOb2RlLmNvbXBvbmVudHMubWF0ZXJpYWwgPyBjdXJXYWxsTm9kZS5jb21wb25lbnRzLm1hdGVyaWFsLm1hdGVyaWFsIDogY3VyV2FsbE5vZGUucGFyZW50Tm9kZS5jb21wb25lbnRzLm1hdGVyaWFsLm1hdGVyaWFsO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChjdXJXYWxsTm9kZS5teU1lc2gpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGN1cldhbGxOb2RlLm15TWVzaC5nZW9tZXRyeSA9IHdhbGxHZW9tO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y3VyV2FsbE5vZGUubXlNZXNoLm1hdGVyaWFsID0gbXlNYXQ7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdGN1cldhbGxOb2RlLm15TWVzaCA9IG5ldyBUSFJFRS5NZXNoKHdhbGxHZW9tLCBteU1hdCk7XHJcblx0XHRcdFx0XHRcdFx0XHRjdXJXYWxsTm9kZS5zZXRPYmplY3QzRCgnd2FsbE1lc2gnLGN1cldhbGxOb2RlLm15TWVzaCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0dmFyIGNhcHM9W107XHJcblx0XHRcdFx0XHRcdGZvcih2YXIgcm9vbUNoaWxkTm9kZUluZGV4PTA7IHJvb21DaGlsZE5vZGVJbmRleDxzY2VuZUNoaWxkTm9kZS5jaGlsZHJlbi5sZW5ndGg7IHJvb21DaGlsZE5vZGVJbmRleCsrKXtcclxuXHRcdFx0XHRcdFx0XHR2YXIgcm9vbUNoaWxkTm9kZSA9IHNjZW5lQ2hpbGROb2RlLmNoaWxkcmVuW3Jvb21DaGlsZE5vZGVJbmRleF07XHJcblx0XHRcdFx0XHRcdFx0aWYgKHJvb21DaGlsZE5vZGUuY29tcG9uZW50cykge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHJvb21DaGlsZE5vZGUuY29tcG9uZW50cy5mbG9vciB8fCByb29tQ2hpbGROb2RlLmNvbXBvbmVudHMuY2VpbGluZykgY2Fwcy5wdXNoKHJvb21DaGlsZE5vZGUpO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRmb3IodmFyIGN1ckNhcE5vZGVJbmRleD0wOyBjdXJDYXBOb2RlSW5kZXg8Y2Fwcy5sZW5ndGg7IGN1ckNhcE5vZGVJbmRleCsrKXtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY3VyQ2FwTm9kZSA9IGNhcHNbY3VyQ2FwTm9kZUluZGV4XTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgaXNDZWlsaW5nID0gY3VyQ2FwTm9kZS5jb21wb25lbnRzLmNlaWxpbmc7XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0dmFyIGNhcFNoYXBlID0gbmV3IFRIUkVFLlNoYXBlKCk7XHJcblx0XHRcdFx0XHRcdFx0Zm9yKHZhciB3YWxsSW5kZXg9MDsgd2FsbEluZGV4PHdhbGxzLmxlbmd0aDsgd2FsbEluZGV4Kyspe1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGN1cldhbGxOb2RlID0gd2FsbHNbd2FsbEluZGV4XTtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBwdFggPSBjdXJXYWxsTm9kZS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGEueDtcclxuXHRcdFx0XHRcdFx0XHRcdHZhciBwdFogPSBjdXJXYWxsTm9kZS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGEuejtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICh3YWxsSW5kZXgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FwU2hhcGUubGluZVRvKHB0WCxwdFopO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FwU2hhcGUubW92ZVRvKHB0WCxwdFopO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR2YXIgY2FwR2VvbSA9IG5ldyBUSFJFRS5TaGFwZUdlb21ldHJ5KGNhcFNoYXBlKTtcclxuXHRcdFx0XHRcdFx0XHRmb3IodmFyIHdhbGxJbmRleD0wOyB3YWxsSW5kZXg8d2FsbHMubGVuZ3RoOyB3YWxsSW5kZXgrKyl7XHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgY3VyV2FsbE5vZGUgPSB3YWxsc1t3YWxsSW5kZXhdO1xyXG5cdFx0XHRcdFx0XHRcdFx0dmFyIGN1clZlcnQgPSBuZXcgVEhSRUUuVmVjdG9yMyhcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FwR2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmdldFgod2FsbEluZGV4KSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FwR2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmdldFkod2FsbEluZGV4KSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0Y2FwR2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmdldFood2FsbEluZGV4KVxyXG5cdFx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRcdGN1clZlcnQuc2V0KGN1clZlcnQueCxjdXJXYWxsTm9kZS5jb21wb25lbnRzLnBvc2l0aW9uLmRhdGEueSxjdXJWZXJ0LnkpO1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKGlzQ2VpbGluZykgY3VyVmVydC55ICs9IGdldFdhbGxIZWlnaHQoY3VyV2FsbE5vZGUpO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y2FwR2VvbS5hdHRyaWJ1dGVzLnBvc2l0aW9uLnNldFhZWih3YWxsSW5kZXgsY3VyVmVydC54LGN1clZlcnQueSxjdXJWZXJ0LnopO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHR2YXIgc2hvdWxkUmV2ZXJzZSA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHRcdGlmICghaXNDZWlsaW5nKSBzaG91bGRSZXZlcnNlID0gIXNob3VsZFJldmVyc2U7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGlzT3V0c2lkZSkgIHNob3VsZFJldmVyc2UgPSAhc2hvdWxkUmV2ZXJzZTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoc2hvdWxkUmV2ZXJzZSkgZmxpcEdlb20oY2FwR2VvbSk7XHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0bWFrZVBsYW5lVXZzKGNhcEdlb20sJ3gnLCd6Jyxpc0NlaWxpbmc/MTotMSwxKTtcclxuXHRcdFx0XHRcdFx0XHRmaW5pc2hHZW9tKGNhcEdlb20pO1xyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdGlmICghY3VyQ2FwTm9kZS5teU1lc2hlcykgY3VyQ2FwTm9kZS5teU1lc2hlcz1bXTtcclxuXHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHR2YXIgdHlwZUxhYmVsID0gaXNDZWlsaW5nP1wiY2VpbGluZ1wiOlwiZmxvb3JcIjtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbXlNYXQgPSBjdXJDYXBOb2RlLmNvbXBvbmVudHMubWF0ZXJpYWwgPyBjdXJDYXBOb2RlLmNvbXBvbmVudHMubWF0ZXJpYWwubWF0ZXJpYWwgOiBjdXJDYXBOb2RlLnBhcmVudE5vZGUuY29tcG9uZW50cy5tYXRlcmlhbC5tYXRlcmlhbDtcclxuXHRcdFx0XHRcdFx0XHRpZiAoY3VyQ2FwTm9kZS5teU1lc2hlc1t0eXBlTGFiZWxdKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRjdXJDYXBOb2RlLm15TWVzaGVzW3R5cGVMYWJlbF0uZ2VvbWV0cnkgPSBjYXBHZW9tO1xyXG5cdFx0XHRcdFx0XHRcdFx0Y3VyQ2FwTm9kZS5teU1lc2hlc1t0eXBlTGFiZWxdLm1hdGVyaWFsID0gbXlNYXQ7XHJcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdGN1ckNhcE5vZGUubXlNZXNoZXNbdHlwZUxhYmVsXSA9IG5ldyBUSFJFRS5NZXNoKGNhcEdlb20sIG15TWF0KTtcclxuXHRcdFx0XHRcdFx0XHRcdGN1ckNhcE5vZGUuc2V0T2JqZWN0M0QodHlwZUxhYmVsLGN1ckNhcE5vZGUubXlNZXNoZXNbdHlwZUxhYmVsXSk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdFxyXG5cdFx0XHRcclxuXHRcdFx0XHJcblx0XHRcdC8vIGdlbmVyYXRlIHRoZSBkb29yIHR1bm5lbHMnIGdlb21ldHJ5OlxyXG5cdFx0XHRcclxuXHRcdFx0Zm9yKHZhciBjdXJEb29ybGlua0VsSW5kZXg9MDsgY3VyRG9vcmxpbmtFbEluZGV4PGRvb3JsaW5rcy5sZW5ndGg7IGN1ckRvb3JsaW5rRWxJbmRleCsrKXtcclxuXHRcdFx0XHR2YXIgY3VyRG9vcmxpbmtFbCA9IGRvb3JsaW5rc1tjdXJEb29ybGlua0VsSW5kZXhdO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHZhciBjdXJEb29ybGluayA9IGN1ckRvb3JsaW5rRWwuY29tcG9uZW50cy5kb29ybGluaztcclxuXHRcdFx0XHRpZiAoIWN1ckRvb3JsaW5rLmRhdGEuZnJvbSkgY29udGludWU7XHJcblx0XHRcdFx0aWYgKCFjdXJEb29ybGluay5kYXRhLnRvKSBjb250aW51ZTtcclxuXHRcdFx0XHRpZiAoIWN1ckRvb3JsaW5rLmRhdGEuZnJvbS5teVZlcnRzKSByZXR1cm47XHJcblx0XHRcdFx0aWYgKCFjdXJEb29ybGluay5kYXRhLnRvLm15VmVydHMpIHJldHVybjtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRmb3IodmFyIGRvb3JMaW5rQ2hpbGRJbmRleD0wOyBkb29yTGlua0NoaWxkSW5kZXg8Y3VyRG9vcmxpbmtFbC5jaGlsZHJlbi5sZW5ndGg7IGRvb3JMaW5rQ2hpbGRJbmRleCsrKXtcclxuXHRcdFx0XHRcdHZhciBkb29yTGlua0NoaWxkID0gY3VyRG9vcmxpbmtFbC5jaGlsZHJlbltkb29yTGlua0NoaWxkSW5kZXhdO1xyXG5cdFx0XHRcdFx0aWYgKCFkb29yTGlua0NoaWxkLmNvbXBvbmVudHMpIGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHR2YXIgdHlwZXM9W1wic2lkZXNcIixcImZsb29yXCIsXCJjZWlsaW5nXCJdO1xyXG5cdFx0XHRcdFx0Zm9yKHZhciBjdXJUeXBlSW5kZXg9MDsgY3VyVHlwZUluZGV4PHR5cGVzLmxlbmd0aDsgY3VyVHlwZUluZGV4Kyspe1xyXG5cdFx0XHRcdFx0XHR2YXIgY3VyVHlwZSA9IHR5cGVzW2N1clR5cGVJbmRleF07XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRpZiAoIWRvb3JMaW5rQ2hpbGQuY29tcG9uZW50c1tjdXJUeXBlXSkgY29udGludWU7XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHR2YXIgbXlNYXQgPSBkb29yTGlua0NoaWxkLmNvbXBvbmVudHMubWF0ZXJpYWw/ZG9vckxpbmtDaGlsZC5jb21wb25lbnRzLm1hdGVyaWFsLm1hdGVyaWFsOmRvb3JMaW5rQ2hpbGQucGFyZW50Tm9kZS5jb21wb25lbnRzLm1hdGVyaWFsLm1hdGVyaWFsO1xyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0aWYgKCFkb29yTGlua0NoaWxkLm15R2VvbXMpIGRvb3JMaW5rQ2hpbGQubXlHZW9tcz1bXTtcclxuXHRcdFx0XHRcdFx0aWYgKCFkb29yTGlua0NoaWxkLm15R2VvbXNbY3VyVHlwZV0pIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgY3VyR2VvbSA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpO1xyXG5cdFx0XHRcdFx0XHRcdGRvb3JMaW5rQ2hpbGQubXlHZW9tc1tjdXJUeXBlXSA9IGN1ckdlb207XHJcblx0XHRcdFx0XHRcdFx0dmFyIG15TWVzaCA9IG5ldyBUSFJFRS5NZXNoKFxyXG5cdFx0XHRcdFx0XHRcdFx0Y3VyR2VvbSxcclxuXHRcdFx0XHRcdFx0XHRcdG15TWF0XHJcblx0XHRcdFx0XHRcdFx0KTtcclxuXHRcdFx0XHRcdFx0XHRjdXJHZW9tLm1lc2hSZWYgPSBteU1lc2g7XHJcblx0XHRcdFx0XHRcdFx0ZG9vckxpbmtDaGlsZC5zZXRPYmplY3QzRChjdXJUeXBlLG15TWVzaCk7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGluZGV4QXJyYXkgPSBbXTtcclxuXHRcdFx0XHRcdFx0XHRpbmRleEFycmF5LnB1c2goIDAsMSwyLCAxLDMsMiApO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChjdXJUeXBlPT1cInNpZGVzXCIpIGluZGV4QXJyYXkucHVzaCggNCw1LDYsIDUsNyw2ICk7XHJcblx0XHRcdFx0XHRcdFx0Y3VyR2VvbS5zZXRJbmRleChpbmRleEFycmF5KTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0dmFyIGN1ckdlb20gPSBkb29yTGlua0NoaWxkLm15R2VvbXNbY3VyVHlwZV07XHJcblx0XHRcdFx0XHRcdGN1ckdlb20ubWVzaFJlZi5tYXRlcmlhbCA9IG15TWF0O1xyXG5cdFx0XHRcdFx0XHR2YXIgcG9zaXRpb25BcnJheSA9IFtdO1xyXG5cdFx0XHRcdFx0XHRmdW5jdGlvbiBhZGRXb3JsZFZlcnRleChwdCl7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGxvY2FsUHQgPSBwdC5jbG9uZSgpO1xyXG5cdFx0XHRcdFx0XHRcdGRvb3JMaW5rQ2hpbGQub2JqZWN0M0Qud29ybGRUb0xvY2FsKGxvY2FsUHQpO1xyXG5cdFx0XHRcdFx0XHRcdHBvc2l0aW9uQXJyYXkucHVzaChsb2NhbFB0LngsbG9jYWxQdC55LGxvY2FsUHQueik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0ZnVuY3Rpb24gY29tbWl0VmVydGljZXMoKXtcclxuXHRcdFx0XHRcdFx0XHRjdXJHZW9tLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUobmV3IEZsb2F0MzJBcnJheShwb3NpdGlvbkFycmF5KSwzKSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0dmFyIGZWZXJ0cz1jdXJEb29ybGluay5kYXRhLmZyb20ubXlWZXJ0cztcclxuXHRcdFx0XHRcdFx0dmFyIHRWZXJ0cz1jdXJEb29ybGluay5kYXRhLnRvLm15VmVydHM7XHJcblx0XHRcdFx0XHRcdHN3aXRjaChjdXJUeXBlKXtcclxuXHRcdFx0XHRcdFx0XHRjYXNlIFwiZmxvb3JcIjpcclxuXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0YWRkV29ybGRWZXJ0ZXgodFZlcnRzWzBdKTtcclxuXHRcdFx0XHRcdFx0XHRcdGFkZFdvcmxkVmVydGV4KHRWZXJ0c1syXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnRleChmVmVydHNbMl0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0YWRkV29ybGRWZXJ0ZXgoZlZlcnRzWzBdKTtcclxuXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0Y29tbWl0VmVydGljZXMoKTtcclxuXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0bWFrZVV2c0Zvckdlb20oY3VyR2VvbSxmdW5jdGlvbihwdCx2ZXJ0SW5kZXgpe1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gW1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdDEtKHZlcnRJbmRleCUyKSxcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQxLU1hdGguZmxvb3IodmVydEluZGV4LzIpXHJcblx0XHRcdFx0XHRcdFx0XHRcdF07XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJjZWlsaW5nXCI6XHJcblx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdGFkZFdvcmxkVmVydGV4KHRWZXJ0c1szXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnRleCh0VmVydHNbMV0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0YWRkV29ybGRWZXJ0ZXgoZlZlcnRzWzFdKTtcclxuXHRcdFx0XHRcdFx0XHRcdGFkZFdvcmxkVmVydGV4KGZWZXJ0c1szXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdGNvbW1pdFZlcnRpY2VzKCk7XHJcblx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdG1ha2VVdnNGb3JHZW9tKGN1ckdlb20sZnVuY3Rpb24ocHQsdmVydEluZGV4KXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIFtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR2ZXJ0SW5kZXglMixcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHQxLU1hdGguZmxvb3IodmVydEluZGV4LzIpXHJcblx0XHRcdFx0XHRcdFx0XHRcdF07XHJcblx0XHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgXCJzaWRlc1wiOlxyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnRleCh0VmVydHNbMl0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0YWRkV29ybGRWZXJ0ZXgodFZlcnRzWzNdKTtcclxuXHRcdFx0XHRcdFx0XHRcdGFkZFdvcmxkVmVydGV4KGZWZXJ0c1swXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnRleChmVmVydHNbMV0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnRleChmVmVydHNbMl0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0YWRkV29ybGRWZXJ0ZXgoZlZlcnRzWzNdKTtcclxuXHRcdFx0XHRcdFx0XHRcdGFkZFdvcmxkVmVydGV4KHRWZXJ0c1swXSk7XHJcblx0XHRcdFx0XHRcdFx0XHRhZGRXb3JsZFZlcnRleCh0VmVydHNbMV0pO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRjb21taXRWZXJ0aWNlcygpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRtYWtlVXZzRm9yR2VvbShjdXJHZW9tLGZ1bmN0aW9uKHB0LHZlcnRJbmRleCl7XHJcblx0XHRcdFx0XHRcdFx0XHRcdHZhciB1diA9IFtdO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR1dlswXSA9IE1hdGguZmxvb3IodmVydEluZGV4LzIpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHR1dlsxXSA9IHZlcnRJbmRleCUyO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAodmVydEluZGV4PDQpIHV2WzBdID0gMS11dlswXTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHV2O1xyXG5cdFx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRmaW5pc2hHZW9tKGN1ckdlb20pO1xyXG5cdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdC8vY29uc29sZS5sb2coXCIgPT09IFJFLUVWQUxVQVRJT04gQ09NUExFVEUhXCIpO1xyXG5cdFx0XHRidWlsZGluZ1NlbGYuZGlydHkgPSBmYWxzZTtcclxuXHRcdFx0XHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRcclxuXHRcdFxyXG5cdH1cclxuXHRcclxufSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVNjZW5lKGxhc3RTY2VuZSl7XHJcblx0aWYgKGxhc3RTY2VuZSAmJiBsYXN0U2NlbmUuc3lzdGVtcy5idWlsZGluZykgbGFzdFNjZW5lLnN5c3RlbXMuYnVpbGRpbmcucmVleGFtaW5lQnVpbGRpbmcoKTtcclxufVxyXG5mdW5jdGlvbiBwb3NpdGlvbldhdGNoKGUpe1xyXG5cdGlmIChlLmRldGFpbC5uYW1lID09IFwicG9zaXRpb25cIikgdXBkYXRlU2NlbmUoZS5kZXRhaWwudGFyZ2V0LnNjZW5lRWwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBub2RlU2NlbmVJbml0KCl7XHJcblx0dGhpcy5sYXN0U2NlbmUgPSB0aGlzLmVsLnNjZW5lRWw7XHJcblx0dXBkYXRlU2NlbmUodGhpcy5sYXN0U2NlbmUpO1xyXG5cdHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcignY29tcG9uZW50Y2hhbmdlZCcscG9zaXRpb25XYXRjaCk7XHJcbn1cclxuZnVuY3Rpb24gbm9kZVNjZW5lVXBkYXRlKCl7XHJcblx0dXBkYXRlU2NlbmUodGhpcy5sYXN0U2NlbmUpO1xyXG59XHJcbmZ1bmN0aW9uIG5vZGVTY2VuZVJlbW92ZSgpe1xyXG5cdHVwZGF0ZVNjZW5lKHRoaXMubGFzdFNjZW5lKTtcclxuXHR0aGlzLmxhc3RTY2VuZSA9IG51bGw7XHJcblx0dGhpcy5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb21wb25lbnRjaGFuZ2VkJyxwb3NpdGlvbldhdGNoKTtcclxufVxyXG5cclxuXHJcbnZhciByZWZyZXNoU2NlbmVDb25maWcgPSB7XHJcblx0aW5pdDpub2RlU2NlbmVJbml0LFxyXG5cdHVwZGF0ZTpub2RlU2NlbmVVcGRhdGUsXHJcblx0cmVtb3ZlOm5vZGVTY2VuZVJlbW92ZVxyXG59O1xyXG5cclxuXHJcblxyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ3Jvb20nLE9iamVjdC5hc3NpZ24oe1xyXG5cdFxyXG5cdHNjaGVtYTp7XHJcblx0XHRvdXRzaWRlOnt0eXBlOidib29sZWFuJ30sXHJcblx0XHRoZWlnaHQ6e3R5cGU6J251bWJlcicsIGRlZmF1bHQ6Mi40fSxcclxuXHRcdHdpZHRoOnt0eXBlOidudW1iZXInfSxcclxuXHRcdGxlbmd0aDp7dHlwZTonbnVtYmVyJ31cclxuXHR9LFxyXG5cdFxyXG59LHJlZnJlc2hTY2VuZUNvbmZpZykpO1xyXG5cclxuQUZSQU1FLnJlZ2lzdGVyQ29tcG9uZW50KCd3YWxsJyxPYmplY3QuYXNzaWduKHtcclxuXHRcclxuXHRzY2hlbWE6e1xyXG5cdFx0aGVpZ2h0Ont0eXBlOidudW1iZXInfSxcclxuXHR9XHJcblx0XHJcbn0scmVmcmVzaFNjZW5lQ29uZmlnKSk7XHJcblxyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ2Zsb29yJyxyZWZyZXNoU2NlbmVDb25maWcpO1xyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ2NlaWxpbmcnLHJlZnJlc2hTY2VuZUNvbmZpZyk7XHJcblxyXG5cclxuQUZSQU1FLnJlZ2lzdGVyQ29tcG9uZW50KCdkb29yaG9sZScscmVmcmVzaFNjZW5lQ29uZmlnKTtcclxuXHJcbkFGUkFNRS5yZWdpc3RlckNvbXBvbmVudCgnZG9vcmxpbmsnLE9iamVjdC5hc3NpZ24oe1xyXG5cdFxyXG5cdHNjaGVtYTp7XHJcblx0XHRmcm9tOnt0eXBlOidzZWxlY3Rvcid9LFxyXG5cdFx0dG86e3R5cGU6J3NlbGVjdG9yJ30sXHJcblx0XHRoZWlnaHQ6e3R5cGU6J251bWJlcicsIGRlZmF1bHQ6Mi4wfSxcclxuXHRcdHdpZHRoOnt0eXBlOidudW1iZXInLCBkZWZhdWx0OjAuOH1cclxuXHR9XHJcblx0XHJcbn0scmVmcmVzaFNjZW5lQ29uZmlnKSk7XHJcblxyXG5BRlJBTUUucmVnaXN0ZXJDb21wb25lbnQoJ3NpZGVzJyxyZWZyZXNoU2NlbmVDb25maWcpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4vLyBjb3VsZCBwcm9iYWJseSBhdXRvbWF0ZSB0aGlzIHJhdGhlciB0aGFuIGhhcmQtY29kaW5nIGl0LCBidXQgdGhpcydsbCBkbyBmb3Igbm93OlxyXG5cclxuQUZSQU1FLnJlZ2lzdGVyUHJpbWl0aXZlKCdydy1yb29tJyx7XHJcblx0ZGVmYXVsdENvbXBvbmVudHM6e3Jvb206e319LFxyXG5cdG1hcHBpbmdzOntcclxuXHRcdG91dHNpZGU6J3Jvb20ub3V0c2lkZScsXHJcblx0XHRoZWlnaHQ6J3Jvb20uaGVpZ2h0JyxcclxuXHRcdHdpZHRoOidyb29tLndpZHRoJyxcclxuXHRcdGxlbmd0aDoncm9vbS5sZW5ndGgnXHJcblx0fVxyXG59KTtcclxuXHJcbkFGUkFNRS5yZWdpc3RlclByaW1pdGl2ZSgncnctd2FsbCcse1xyXG5cdGRlZmF1bHRDb21wb25lbnRzOnt3YWxsOnt9fSxcclxuXHRtYXBwaW5nczp7XHJcblx0XHRoZWlnaHQ6J3dhbGwuaGVpZ2h0J1xyXG5cdH1cclxufSk7XHJcblxyXG5BRlJBTUUucmVnaXN0ZXJQcmltaXRpdmUoJ3J3LWZsb29yJyx7XHJcblx0ZGVmYXVsdENvbXBvbmVudHM6e2Zsb29yOnt9fSxcclxuXHRtYXBwaW5nczp7fVxyXG59KTtcclxuXHJcbkFGUkFNRS5yZWdpc3RlclByaW1pdGl2ZSgncnctY2VpbGluZycse1xyXG5cdGRlZmF1bHRDb21wb25lbnRzOntjZWlsaW5nOnt9fSxcclxuXHRtYXBwaW5nczp7fVxyXG59KTtcclxuXHJcbkFGUkFNRS5yZWdpc3RlclByaW1pdGl2ZSgncnctZG9vcmhvbGUnLHtcclxuXHRkZWZhdWx0Q29tcG9uZW50czp7ZG9vcmhvbGU6e319LFxyXG5cdG1hcHBpbmdzOnt9XHJcbn0pO1xyXG5cclxuQUZSQU1FLnJlZ2lzdGVyUHJpbWl0aXZlKCdydy1kb29ybGluaycse1xyXG5cdGRlZmF1bHRDb21wb25lbnRzOntkb29ybGluazp7fX0sXHJcblx0bWFwcGluZ3M6e1xyXG5cdFx0ZnJvbTonZG9vcmxpbmsuZnJvbScsXHJcblx0XHR0bzonZG9vcmxpbmsudG8nLFxyXG5cdFx0aGVpZ2h0Oidkb29ybGluay5oZWlnaHQnLFxyXG5cdFx0d2lkdGg6J2Rvb3JsaW5rLndpZHRoJyxcclxuXHR9XHJcbn0pO1xyXG5cclxuQUZSQU1FLnJlZ2lzdGVyUHJpbWl0aXZlKCdydy1zaWRlcycse1xyXG5cdGRlZmF1bHRDb21wb25lbnRzOntzaWRlczp7fX0sXHJcblx0bWFwcGluZ3M6e31cclxufSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./index.js\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./index.js"]();
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});